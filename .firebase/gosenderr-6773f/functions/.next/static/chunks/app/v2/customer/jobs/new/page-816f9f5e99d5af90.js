(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[292],{355:(e,t,i)=>{"use strict";i.d(t,{EN:()=>a,mv:()=>o,qF:()=>l});let r={open:null,assigned:"enroute_pickup",enroute_pickup:"arrived_pickup",arrived_pickup:"picked_up",picked_up:"enroute_dropoff",enroute_dropoff:"arrived_dropoff",arrived_dropoff:"completed",completed:null,cancelled:null},o={open:"",assigned:"Start to Pickup",enroute_pickup:"Arrived at Pickup",arrived_pickup:"Confirm Pickup",picked_up:"Start to Dropoff",enroute_dropoff:"Arrived at Dropoff",arrived_dropoff:"Complete Delivery",completed:"",cancelled:""};function a(e){return r[e]}function l(e,t){return e.courierUid===t&&"completed"!==e.status&&"cancelled"!==e.status&&"open"!==e.status&&null!==r[e.status]}},1698:(e,t,i)=>{"use strict";function r(e,t,i){return void 0!==e.maxPickupMiles&&i>e.maxPickupMiles?{eligible:!1,reason:"Pickup is outside courier radius"}:void 0!==e.maxJobMiles&&t>e.maxJobMiles?{eligible:!1,reason:"Trip distance exceeds courier max"}:{eligible:!0}}i.d(t,{m:()=>r})},4834:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>m});var r=i(912),o=i(4012),a=i(5951),l=i(5284);function n(e){let{onSubmit:t,loading:i=!1,onPickupDropoffChange:a}=e,[l,n]=(0,o.useState)(""),[s,d]=(0,o.useState)(""),[p,c]=(0,o.useState)(""),[u,x]=(0,o.useState)(""),[f,g]=(0,o.useState)(""),[m,h]=(0,o.useState)(""),[b,y]=(0,o.useState)(""),v=()=>{if(a){let e=parseFloat(s),t=parseFloat(p),i=parseFloat(f),r=parseFloat(m);a(isNaN(e)||isNaN(t)?null:{lat:e,lng:t},isNaN(i)||isNaN(r)?null:{lat:i,lng:r})}},j=async e=>{e.preventDefault(),y("");let i=parseFloat(s),r=parseFloat(p),o=parseFloat(f),a=parseFloat(m);if(isNaN(i)||i<-90||i>90)return void y("Pickup latitude must be between -90 and 90");if(isNaN(r)||r<-180||r>180)return void y("Pickup longitude must be between -180 and 180");if(isNaN(o)||o<-90||o>90)return void y("Dropoff latitude must be between -90 and 90");if(isNaN(a)||a<-180||a>180)return void y("Dropoff longitude must be between -180 and 180");let n={pickup:{lat:i,lng:r,...l&&{label:l}},dropoff:{lat:o,lng:a,...u&&{label:u}}};await t(n)};return(0,r.jsxs)("form",{onSubmit:j,style:{maxWidth:"500px"},children:[(0,r.jsx)("h3",{style:{marginBottom:"20px"},children:"Pickup Location"}),(0,r.jsxs)("div",{style:{marginBottom:"12px"},children:[(0,r.jsx)("label",{style:{display:"block",marginBottom:"4px",fontSize:"14px"},children:"Label (optional)"}),(0,r.jsx)("input",{type:"text",value:l,onChange:e=>n(e.target.value),placeholder:"e.g., Home, Office",style:{width:"100%",padding:"8px",borderRadius:"4px",border:"1px solid #ccc"}})]}),(0,r.jsxs)("div",{style:{display:"flex",gap:"12px",marginBottom:"24px"},children:[(0,r.jsxs)("div",{style:{flex:1},children:[(0,r.jsx)("label",{style:{display:"block",marginBottom:"4px",fontSize:"14px"},children:"Latitude *"}),(0,r.jsx)("input",{type:"number",step:"any",value:s,onChange:e=>{d(e.target.value),setTimeout(v,300)},placeholder:"37.7749",required:!0,style:{width:"100%",padding:"8px",borderRadius:"4px",border:"1px solid #ccc"}})]}),(0,r.jsxs)("div",{style:{flex:1},children:[(0,r.jsx)("label",{style:{display:"block",marginBottom:"4px",fontSize:"14px"},children:"Longitude *"}),(0,r.jsx)("input",{type:"number",step:"any",value:p,onChange:e=>{c(e.target.value),setTimeout(v,300)},placeholder:"-122.4194",required:!0,style:{width:"100%",padding:"8px",borderRadius:"4px",border:"1px solid #ccc"}})]})]}),(0,r.jsx)("h3",{style:{marginBottom:"20px"},children:"Dropoff Location"}),(0,r.jsxs)("div",{style:{marginBottom:"12px"},children:[(0,r.jsx)("label",{style:{display:"block",marginBottom:"4px",fontSize:"14px"},children:"Label (optional)"}),(0,r.jsx)("input",{type:"text",value:u,onChange:e=>x(e.target.value),placeholder:"e.g., Restaurant, Store",style:{width:"100%",padding:"8px",borderRadius:"4px",border:"1px solid #ccc"}})]}),(0,r.jsxs)("div",{style:{display:"flex",gap:"12px",marginBottom:"24px"},children:[(0,r.jsxs)("div",{style:{flex:1},children:[(0,r.jsx)("label",{style:{display:"block",marginBottom:"4px",fontSize:"14px"},children:"Latitude *"}),(0,r.jsx)("input",{type:"number",step:"any",value:f,onChange:e=>{g(e.target.value),setTimeout(v,300)},placeholder:"37.7849",required:!0,style:{width:"100%",padding:"8px",borderRadius:"4px",border:"1px solid #ccc"}})]}),(0,r.jsxs)("div",{style:{flex:1},children:[(0,r.jsx)("label",{style:{display:"block",marginBottom:"4px",fontSize:"14px"},children:"Longitude *"}),(0,r.jsx)("input",{type:"number",step:"any",value:m,onChange:e=>{h(e.target.value),setTimeout(v,300)},placeholder:"-122.4094",required:!0,style:{width:"100%",padding:"8px",borderRadius:"4px",border:"1px solid #ccc"}})]})]}),b&&(0,r.jsx)("div",{style:{padding:"12px",background:"#fee",color:"#c00",borderRadius:"4px",marginBottom:"16px",fontSize:"14px"},children:b}),(0,r.jsx)("button",{type:"submit",disabled:i,style:{padding:"12px 24px",background:i?"#ccc":"#6E56CF",color:"white",border:"none",borderRadius:"8px",fontSize:"16px",fontWeight:"600",cursor:i?"not-allowed":"pointer"},children:i?"Creating...":"Create Job"})]})}var s=i(4555),d=i(9685),p=i(7697),c=i(1698),u=i(8860),x=i.n(u),f=i(7473);let g={baseFee:5,perMile:1.5,minFee:7,pickupPerMile:.5,perMinute:0,maxPickupMiles:10,maxJobMiles:25};function m(){let e=(0,a.useRouter)(),{uid:t}=(0,l.Z)(),[i,u]=(0,o.useState)(!1),[m,h]=(0,o.useState)(null),[b,y]=(0,o.useState)(null),{couriers:v,loading:j}=function(e,t){let[i,r]=(0,o.useState)([]),[a,l]=(0,o.useState)(!1);return(0,o.useEffect)(()=>{if(!e||!t)return void r([]);(async()=>{l(!0);try{let i=x().encode(e.lat,e.lng,5),o=(0,s.rJ)(d.db,"users"),a=(0,s.P)(o,(0,s._M)("role","==","courier"),(0,s._M)("courier.isOnline","==",!0),(0,s._M)("location.geohash",">=",i),(0,s._M)("location.geohash","<=",i+"")),l=await (0,s.GG)(a),n=(0,p.Sr)(e,t),u=[];l.forEach(t=>{var i;let r=t.data();if(!r.location||!(null==(i=r.courier)?void 0:i.rateCard))return;let o={lat:r.location.lat,lng:r.location.lng},a=(0,p.Sr)(o,e),l=r.courier.rateCard,s=(0,c.m)(l,n,a),d=s.eligible,x=s.reason,f=(0,p.qY)(l,n,a,r.courier.transportMode);u.push({uid:t.id,email:r.email||"Courier",transportMode:r.courier.transportMode,pickupMiles:a,jobMiles:n,estimatedFee:f,eligible:d,reason:x,rateCard:l})}),u.sort((e,t)=>e.eligible&&!t.eligible?-1:!e.eligible&&t.eligible?1:e.estimatedFee-t.estimatedFee),r(u)}catch(e){console.error("Failed to fetch nearby couriers:",e),r([])}finally{l(!1)}})()},[e,t]),{couriers:i,loading:a}}(m,b),{jobMiles:S,minEstimate:k,estimateSource:w}=(0,o.useMemo)(()=>{if(!m||!b)return{jobMiles:0,minEstimate:0,estimateSource:"none"};let e=(0,p.Sr)(m,b),t=v.filter(e=>e.eligible);if(t.length>0)return{jobMiles:e,minEstimate:Math.min(...t.map(e=>e.estimatedFee)),estimateSource:"couriers"};{let t=(0,p.qY)(g,e,void 0,"car");return{jobMiles:e,minEstimate:t,estimateSource:"floor"}}},[m,b,v]),C=async i=>{if(t){u(!0);try{let r=await (0,f._S)(t,i);e.push("/v2/customer/jobs/".concat(r))}catch(e){console.error("Failed to create job:",e),alert("Failed to create job. Please try again."),u(!1)}}};return(0,r.jsxs)("div",{style:{padding:"30px",maxWidth:"1200px",margin:"0 auto"},children:[(0,r.jsx)("h1",{style:{marginBottom:"30px"},children:"Create New Job"}),(0,r.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 400px",gap:"30px"},children:[(0,r.jsx)("div",{children:(0,r.jsx)(n,{onSubmit:C,loading:i,onPickupDropoffChange:(e,t)=>{e&&e.lat&&e.lng?h({lat:e.lat,lng:e.lng}):h(null),t&&t.lat&&t.lng?y({lat:t.lat,lng:t.lng}):y(null)}})}),m&&b&&(0,r.jsxs)("div",{style:{position:"sticky",top:"20px",height:"fit-content"},children:[(0,r.jsxs)("div",{style:{marginBottom:"20px",padding:"20px",background:"white",border:"2px solid #6E56CF",borderRadius:"8px"},children:[(0,r.jsx)("h4",{style:{marginTop:0,marginBottom:"12px",color:"#6E56CF",fontSize:"14px",fontWeight:"600"},children:"Minimum Estimate (for this trip)"}),(0,r.jsxs)("div",{style:{marginBottom:"12px"},children:[(0,r.jsx)("div",{style:{fontSize:"12px",color:"#666",marginBottom:"4px"},children:"Distance"}),(0,r.jsxs)("div",{style:{fontSize:"16px",fontWeight:"600"},children:[S.toFixed(2)," miles"]})]}),(0,r.jsxs)("div",{style:{marginBottom:"12px"},children:[(0,r.jsx)("div",{style:{fontSize:"12px",color:"#666",marginBottom:"4px"},children:"Minimum"}),(0,r.jsxs)("div",{style:{fontSize:"24px",fontWeight:"700",color:"#16a34a"},children:["$",k.toFixed(2)]}),(0,r.jsx)("div",{style:{fontSize:"11px",color:"#999",marginTop:"2px",fontStyle:"italic"},children:"couriers"===w?"from nearby couriers":"floor"===w?"No eligible couriers online":"typical courier rates"})]}),(0,r.jsx)("div",{style:{padding:"10px",background:"#fef9e7",border:"1px solid #f9e79f",borderRadius:"4px",fontSize:"11px",color:"#856404"},children:"⚠️ Estimate only. Couriers set their own rates and final price may differ."})]}),(0,r.jsxs)("div",{style:{padding:"20px",background:"white",border:"1px solid #ddd",borderRadius:"8px"},children:[(0,r.jsx)("h3",{style:{marginTop:0,marginBottom:"16px"},children:"Nearby Couriers"}),j?(0,r.jsx)("p",{style:{color:"#666",fontSize:"14px"},children:"Loading nearby couriers..."}):0===v.length?(0,r.jsx)("p",{style:{color:"#999",fontSize:"14px"},children:"No online couriers found in this area."}):(0,r.jsx)("div",{style:{display:"grid",gap:"12px",maxHeight:"600px",overflowY:"auto"},children:v.map(e=>(0,r.jsxs)("div",{style:{padding:"12px",background:e.eligible?"#f0fdf4":"#fef2f2",border:"1px solid ".concat(e.eligible?"#86efac":"#fecaca"),borderRadius:"6px"},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:"8px"},children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{style:{fontWeight:"600",fontSize:"14px",marginBottom:"4px"},children:e.email}),(0,r.jsxs)("div",{style:{fontSize:"12px",color:"#666"},children:["walk"===e.transportMode&&"\uD83D\uDEB6 Walk","scooter"===e.transportMode&&"\uD83D\uDEF4 Scooter","car"===e.transportMode&&"\uD83D\uDE97 Car"]})]}),(0,r.jsx)("div",{style:{padding:"4px 8px",background:e.eligible?"#16a34a":"#dc2626",color:"white",fontSize:"11px",fontWeight:"600",borderRadius:"4px"},children:e.eligible?"Eligible":"Not eligible"})]}),(0,r.jsxs)("div",{style:{fontSize:"12px",color:"#666",marginBottom:"8px"},children:[(0,r.jsxs)("div",{children:["\uD83D\uDCCD ",e.pickupMiles.toFixed(1)," mi to pickup"]}),(0,r.jsxs)("div",{children:["\uD83D\uDCE6 ",e.jobMiles.toFixed(1)," mi job distance"]})]}),(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsx)("div",{style:{fontSize:"12px",color:"#999"},children:"Estimated Fee:"}),(0,r.jsxs)("div",{style:{fontSize:"16px",fontWeight:"600",color:e.eligible?"#16a34a":"#dc2626"},children:["$",e.estimatedFee.toFixed(2)]})]}),!e.eligible&&e.reason&&(0,r.jsx)("div",{style:{marginTop:"8px",fontSize:"11px",color:"#dc2626"},children:e.reason})]},e.uid))}),(0,r.jsx)("div",{style:{marginTop:"16px",padding:"12px",background:"#f5f5f5",borderRadius:"6px",fontSize:"12px",color:"#666"},children:"ℹ️ These are couriers currently online in your pickup area. Fees are estimates and may change when a courier accepts."})]})]})]})]})}},7473:(e,t,i)=>{"use strict";i.d(t,{G7:()=>d,_S:()=>s,r7:()=>p});var r=i(4555),o=i(9685),a=i(7697),l=i(1698),n=i(355);async function s(e,t){let i=(0,r.rJ)(o.db,"jobs");return(await (0,r.gS)(i,{createdByUid:e,status:"open",pickup:t.pickup,dropoff:t.dropoff,courierUid:null,agreedFee:null,createdAt:(0,r.O5)(),updatedAt:(0,r.O5)()})).id}async function d(e,t,i){let n=(0,r.H9)(o.db,"jobs",e),s=(0,r.H9)(o.db,"users",t);await (0,r.c4)(o.db,async e=>{var o;let d=await e.get(n),p=await e.get(s);if(!d.exists())throw Error("Job not found");if(!p.exists())throw Error("Courier not found");let c=d.data(),u=p.data();if("open"!==c.status||null!==c.courierUid)throw Error("Job already claimed or not available");if(!u.location||!(null==(o=u.courier)?void 0:o.rateCard))throw Error("Courier location or rate card not configured");let x=u.location,f=u.courier.rateCard,g=c.pickup,m=c.dropoff,h=(0,a.Sr)(x,g),b=(0,a.Sr)(g,m),y=(0,l.m)(f,b,h);if(!y.eligible)throw Error("not-eligible: ".concat(y.reason||"Job exceeds distance limits"));e.update(n,{courierUid:t,agreedFee:i,status:"assigned",updatedAt:(0,r.O5)()})})}async function p(e,t,i){let a=(0,r.H9)(o.db,"jobs",e);await (0,r.c4)(o.db,async e=>{let o=await e.get(a);if(!o.exists())throw Error("Job not found");let l=o.data();if(i&&l.courierUid!==i)throw Error("Only the assigned courier can update job status");let s=(0,n.EN)(l.status);if(!s)throw Error("Cannot advance from status: ".concat(l.status));if(t!==s)throw Error("Invalid status transition. Expected: ".concat(s,", Received: ").concat(t));e.update(a,{status:t,updatedAt:(0,r.O5)()})})}},9355:(e,t,i)=>{Promise.resolve().then(i.bind(i,4834))}},e=>{e.O(0,[680,661,825,846,429,808,4,358],()=>e(e.s=9355)),_N_E=e.O()}]);