(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[333],{1082:(e,t,i)=>{"use strict";i.d(t,{h:()=>o});var r=i(9740);function o(){let{userDoc:e,loading:t,uid:i}=(0,r.T)();return{role:null==e?void 0:e.role,loading:t,uid:i,userDoc:e}}},2400:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>x});var r=i(912),o=i(4012),l=i(4555),n=i(9685),a=i(1082),s=i(8860),d=i.n(s),p=i(7697),c=i(5951);function x(){let{uid:e,userDoc:t}=(0,a.h)(),{isTracking:i,permissionDenied:s}=function(){var e;let{role:t,uid:i,userDoc:r}=(0,a.h)(),[s,p]=(0,o.useState)(!1),[c,x]=(0,o.useState)(!1),u=(0,o.useRef)(null),h=(0,o.useRef)(0),g=(0,o.useRef)(null);return(0,o.useEffect)(()=>{var e;if(!("courier"===t&&i&&(null==r||null==(e=r.courier)?void 0:e.isOnline)===!0)){null!==u.current&&(navigator.geolocation.clearWatch(u.current),u.current=null,x(!1));return}return null===u.current&&(x(!0),p(!1),u.current=navigator.geolocation.watchPosition(async e=>{let{latitude:t,longitude:r,heading:o}=e.coords,a=Date.now(),s=a-h.current>=5e3;if(!s&&g.current&&(s=function(e,t,i,r){let o=e*Math.PI/180,l=i*Math.PI/180,n=(i-e)*Math.PI/180,a=(r-t)*Math.PI/180,s=Math.sin(n/2)*Math.sin(n/2)+Math.cos(o)*Math.cos(l)*Math.sin(a/2)*Math.sin(a/2);return 2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s))*6371e3}(g.current.lat,g.current.lng,t,r)>=25),s&&i)try{let e=d().encode(t,r,6);await (0,l.mZ)((0,l.H9)(n.db,"users",i),{"location.lat":t,"location.lng":r,"location.geohash":e,...null!==o&&{"location.heading":o},"location.updatedAt":(0,l.O5)()}),h.current=a,g.current={lat:t,lng:r}}catch(e){console.error("Failed to update courier location:",e)}},e=>{console.error("Geolocation error:",e),e.code===e.PERMISSION_DENIED&&p(!0)},{enableHighAccuracy:!0,maximumAge:0,timeout:1e4})),()=>{null!==u.current&&(navigator.geolocation.clearWatch(u.current),u.current=null,x(!1))}},[t,i,null==r||null==(e=r.courier)?void 0:e.isOnline]),{isTracking:c,permissionDenied:s}}();(0,c.useRouter)();let[x,u]=(0,o.useState)("car"),[h,g]=(0,o.useState)("5"),[m,y]=(0,o.useState)("1.5"),[f,v]=(0,o.useState)(""),[b,j]=(0,o.useState)(""),[S,M]=(0,o.useState)(""),[k,F]=(0,o.useState)(""),[B,C]=(0,o.useState)(""),[z,T]=(0,o.useState)(!1),[P,w]=(0,o.useState)(!1),[R,W]=(0,o.useState)(!1);(0,o.useEffect)(()=>{(null==t?void 0:t.courier)&&(u(t.courier.transportMode),g(String(t.courier.rateCard.baseFee)),y(String(t.courier.rateCard.perMile)),v(t.courier.rateCard.minFee?String(t.courier.rateCard.minFee):""),j(t.courier.rateCard.pickupPerMile?String(t.courier.rateCard.pickupPerMile):""),M(t.courier.rateCard.perMinute?String(t.courier.rateCard.perMinute):""),F(t.courier.rateCard.maxPickupMiles?String(t.courier.rateCard.maxPickupMiles):""),C(t.courier.rateCard.maxJobMiles?String(t.courier.rateCard.maxJobMiles):""),T(t.courier.isOnline))},[t]);let E=async t=>{if(t.preventDefault(),e){w(!0),W(!1);try{let t={baseFee:parseFloat(h)||0,perMile:parseFloat(m)||0},i=parseFloat(f);i>0&&(t.minFee=i);let r=parseFloat(b);r>0&&(t.pickupPerMile=r);let o=parseFloat(S);o>0&&(t.perMinute=o);let a=parseFloat(k);a>0&&(t.maxPickupMiles=a);let s=parseFloat(B);s>0&&(t.maxJobMiles=s),await (0,l.mZ)((0,l.H9)(n.db,"users",e),{"courier.transportMode":x,"courier.rateCard":t,"courier.isOnline":z,updatedAt:(0,l.O5)()}),W(!0),setTimeout(()=>W(!1),3e3)}catch(e){console.error("Failed to save courier settings:",e),alert("Failed to save settings. Please try again.")}finally{w(!1)}}},D=(e,t)=>{let i={baseFee:parseFloat(h)||0,perMile:parseFloat(m)||0,minFee:parseFloat(f)||void 0,pickupPerMile:parseFloat(b)||void 0,perMinute:parseFloat(S)||void 0,maxPickupMiles:parseFloat(k)||void 0,maxJobMiles:parseFloat(B)||void 0};return(0,p.qY)(i,e,t,x).toFixed(2)};return(0,r.jsxs)("div",{style:{padding:"50px",maxWidth:"800px",margin:"0 auto"},children:[(0,r.jsxs)("div",{style:{marginBottom:"30px"},children:[(0,r.jsx)("h1",{children:"Courier Setup"}),(0,r.jsx)("p",{style:{color:"#666",marginTop:"10px"},children:"Configure your delivery settings and flexible pricing"})]}),(0,r.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 350px",gap:"30px"},children:[(0,r.jsxs)("form",{onSubmit:E,children:[(0,r.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,r.jsx)("label",{style:{display:"block",marginBottom:"8px",fontWeight:"600"},children:"Transport Mode"}),(0,r.jsxs)("select",{value:x,onChange:e=>u(e.target.value),style:{width:"100%",padding:"10px",border:"1px solid #ddd",borderRadius:"6px",fontSize:"14px"},children:[(0,r.jsx)("option",{value:"walk",children:"\uD83D\uDEB6 Walk (3 mph)"}),(0,r.jsx)("option",{value:"scooter",children:"\uD83D\uDEF4 Scooter (10 mph)"}),(0,r.jsx)("option",{value:"car",children:"\uD83D\uDE97 Car (25 mph)"})]})]}),(0,r.jsx)("h3",{style:{marginTop:"30px",marginBottom:"16px"},children:"Base Pricing"}),(0,r.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,r.jsxs)("label",{style:{display:"block",marginBottom:"8px",fontWeight:"600"},children:["Base Fee ($) ",(0,r.jsx)("span",{style:{color:"#e11d48"},children:"*"})]}),(0,r.jsx)("input",{type:"number",value:h,onChange:e=>g(e.target.value),min:"0",step:"0.50",required:!0,style:{width:"100%",padding:"10px",border:"1px solid #ddd",borderRadius:"6px",fontSize:"14px"}}),(0,r.jsx)("p",{style:{fontSize:"12px",color:"#999",marginTop:"4px"},children:"Fixed fee charged for every delivery"})]}),(0,r.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,r.jsxs)("label",{style:{display:"block",marginBottom:"8px",fontWeight:"600"},children:["Per Mile Rate ($) ",(0,r.jsx)("span",{style:{color:"#e11d48"},children:"*"})]}),(0,r.jsx)("input",{type:"number",value:m,onChange:e=>y(e.target.value),min:"0",step:"0.25",required:!0,style:{width:"100%",padding:"10px",border:"1px solid #ddd",borderRadius:"6px",fontSize:"14px"}}),(0,r.jsx)("p",{style:{fontSize:"12px",color:"#999",marginTop:"4px"},children:"Cost per mile from pickup to dropoff"})]}),(0,r.jsx)("h3",{style:{marginTop:"30px",marginBottom:"16px"},children:"Additional Charges (Optional)"}),(0,r.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"24px"},children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{style:{display:"block",marginBottom:"8px",fontWeight:"600"},children:"Pickup Per Mile ($)"}),(0,r.jsx)("input",{type:"number",value:b,onChange:e=>j(e.target.value),min:"0",step:"0.25",placeholder:"0",style:{width:"100%",padding:"10px",border:"1px solid #ddd",borderRadius:"6px",fontSize:"14px"}}),(0,r.jsx)("p",{style:{fontSize:"12px",color:"#999",marginTop:"4px"},children:"Extra cost to reach pickup"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{style:{display:"block",marginBottom:"8px",fontWeight:"600"},children:"Per Minute Rate ($)"}),(0,r.jsx)("input",{type:"number",value:S,onChange:e=>M(e.target.value),min:"0",step:"0.05",placeholder:"0",style:{width:"100%",padding:"10px",border:"1px solid #ddd",borderRadius:"6px",fontSize:"14px"}}),(0,r.jsx)("p",{style:{fontSize:"12px",color:"#999",marginTop:"4px"},children:"Time-based pricing"})]})]}),(0,r.jsx)("h3",{style:{marginTop:"30px",marginBottom:"16px"},children:"Limits (Optional)"}),(0,r.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"24px"},children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{style:{display:"block",marginBottom:"8px",fontWeight:"600"},children:"Minimum Fee ($)"}),(0,r.jsx)("input",{type:"number",value:f,onChange:e=>v(e.target.value),min:"0",step:"0.50",placeholder:"No minimum",style:{width:"100%",padding:"10px",border:"1px solid #ddd",borderRadius:"6px",fontSize:"14px"}})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{style:{display:"block",marginBottom:"8px",fontWeight:"600"},children:"Max Pickup Miles"}),(0,r.jsx)("input",{type:"number",value:k,onChange:e=>F(e.target.value),min:"0",step:"1",placeholder:"No limit",style:{width:"100%",padding:"10px",border:"1px solid #ddd",borderRadius:"6px",fontSize:"14px"}}),(0,r.jsx)("p",{style:{fontSize:"12px",color:"#999",marginTop:"4px"},children:"Max distance to pickup"})]})]}),(0,r.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,r.jsx)("label",{style:{display:"block",marginBottom:"8px",fontWeight:"600"},children:"Max Job Miles"}),(0,r.jsx)("input",{type:"number",value:B,onChange:e=>C(e.target.value),min:"0",step:"1",placeholder:"No limit",style:{width:"100%",padding:"10px",border:"1px solid #ddd",borderRadius:"6px",fontSize:"14px"}}),(0,r.jsx)("p",{style:{fontSize:"12px",color:"#999",marginTop:"4px"},children:"Max pickup to dropoff distance"})]}),(0,r.jsxs)("div",{style:{marginBottom:"24px",padding:"16px",background:"#f5f5f5",borderRadius:"8px"},children:[(0,r.jsxs)("label",{style:{display:"flex",alignItems:"center",cursor:"pointer"},children:[(0,r.jsx)("input",{type:"checkbox",checked:z,onChange:e=>T(e.target.checked),style:{marginRight:"12px",width:"18px",height:"18px"}}),(0,r.jsx)("span",{style:{fontWeight:"600",fontSize:"16px"},children:"Go Online"})]}),(0,r.jsxs)("p",{style:{fontSize:"12px",color:"#666",marginTop:"8px",marginLeft:"30px"},children:[i&&"\uD83D\uDFE2 Location tracking active",s&&"⚫ Location permission denied",!i&&!s&&"⚫ Location tracking inactive"]})]}),(0,r.jsx)("button",{type:"submit",disabled:P,style:{width:"100%",padding:"12px",background:P?"#ccc":"#6E56CF",color:"white",border:"none",borderRadius:"8px",fontSize:"16px",fontWeight:"600",cursor:P?"not-allowed":"pointer"},children:P?"Saving...":"Save Settings"}),R&&(0,r.jsx)("div",{style:{marginTop:"12px",padding:"12px",background:"#f0fdf4",border:"1px solid #86efac",borderRadius:"6px",color:"#166534",textAlign:"center"},children:"✅ Settings saved successfully!"})]}),(0,r.jsx)("div",{style:{position:"sticky",top:"20px",height:"fit-content"},children:(0,r.jsxs)("div",{style:{padding:"20px",background:"white",border:"1px solid #ddd",borderRadius:"8px"},children:[(0,r.jsx)("h3",{style:{marginTop:0,marginBottom:"16px"},children:"Rate Preview"}),(0,r.jsxs)("div",{style:{marginBottom:"16px",fontSize:"14px",color:"#666"},children:[(0,r.jsx)("strong",{children:"Transport:"})," ",x," (","walk"===x?"3":"scooter"===x?"10":"25"," mph)"]}),(0,r.jsxs)("div",{style:{borderTop:"1px solid #eee",paddingTop:"16px"},children:[(0,r.jsxs)("div",{style:{marginBottom:"12px"},children:[(0,r.jsx)("div",{style:{fontSize:"12px",color:"#999",marginBottom:"4px"},children:"1 mile job (no pickup distance)"}),(0,r.jsxs)("div",{style:{fontSize:"18px",fontWeight:"600",color:"#16a34a"},children:["$",D(1)]})]}),(0,r.jsxs)("div",{style:{marginBottom:"12px"},children:[(0,r.jsx)("div",{style:{fontSize:"12px",color:"#999",marginBottom:"4px"},children:"5 mile job (2 mi pickup)"}),(0,r.jsxs)("div",{style:{fontSize:"18px",fontWeight:"600",color:"#16a34a"},children:["$",D(5,2)]})]}),(0,r.jsxs)("div",{style:{marginBottom:"12px"},children:[(0,r.jsx)("div",{style:{fontSize:"12px",color:"#999",marginBottom:"4px"},children:"10 mile job (3 mi pickup)"}),(0,r.jsxs)("div",{style:{fontSize:"18px",fontWeight:"600",color:"#16a34a"},children:["$",D(10,3)]})]})]}),(parseFloat(f)>0||parseFloat(k)>0||parseFloat(B)>0)&&(0,r.jsxs)("div",{style:{borderTop:"1px solid #eee",paddingTop:"16px",marginTop:"16px"},children:[(0,r.jsx)("div",{style:{fontSize:"12px",fontWeight:"600",marginBottom:"8px"},children:"Active Limits:"}),parseFloat(f)>0&&(0,r.jsxs)("div",{style:{fontSize:"12px",color:"#666",marginBottom:"4px"},children:["• Minimum fee: $",parseFloat(f).toFixed(2)]}),parseFloat(k)>0&&(0,r.jsxs)("div",{style:{fontSize:"12px",color:"#666",marginBottom:"4px"},children:["• Max pickup: ",k," mi"]}),parseFloat(B)>0&&(0,r.jsxs)("div",{style:{fontSize:"12px",color:"#666",marginBottom:"4px"},children:["• Max job: ",B," mi"]})]})]})})]})]})}},4840:(e,t,i)=>{Promise.resolve().then(i.bind(i,2400))},9740:(e,t,i)=>{"use strict";i.d(t,{T:()=>a});var r=i(4012),o=i(4555),l=i(9685),n=i(5284);function a(){let{uid:e,loading:t}=(0,n.Z)(),[i,a]=(0,r.useState)(void 0),[s,d]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{if(t)return void d(!0);if(!e){a(null),d(!1);return}let i=(0,o.aQ)((0,o.H9)(l.db,"users",e),e=>{e.exists()?a(e.data()):a(null),d(!1)},e=>{console.error("Error fetching user doc:",e),a(null),d(!1)});return()=>i()},[e,t]),{userDoc:i,loading:s,uid:e}}}},e=>{e.O(0,[680,661,825,846,429,808,4,358],()=>e(e.s=4840)),_N_E=e.O()}]);