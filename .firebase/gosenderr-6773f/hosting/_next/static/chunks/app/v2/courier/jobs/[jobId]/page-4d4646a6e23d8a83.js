(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[395],{355:(e,t,r)=>{"use strict";r.d(t,{EN:()=>n,mv:()=>i,qF:()=>a});let o={open:null,assigned:"enroute_pickup",enroute_pickup:"arrived_pickup",arrived_pickup:"picked_up",picked_up:"enroute_dropoff",enroute_dropoff:"arrived_dropoff",arrived_dropoff:"completed",completed:null,cancelled:null},i={open:"",assigned:"Start to Pickup",enroute_pickup:"Arrived at Pickup",arrived_pickup:"Confirm Pickup",picked_up:"Start to Dropoff",enroute_dropoff:"Arrived at Dropoff",arrived_dropoff:"Complete Delivery",completed:"",cancelled:""};function n(e){return o[e]}function a(e,t){return e.courierUid===t&&"completed"!==e.status&&"cancelled"!==e.status&&"open"!==e.status&&null!==o[e.status]}},747:(e,t,r)=>{"use strict";r.d(t,{m:()=>n});var o=r(912);let i=[{status:"open",label:"Job Posted"},{status:"assigned",label:"Courier Assigned"},{status:"enroute_pickup",label:"En Route to Pickup"},{status:"arrived_pickup",label:"Arrived at Pickup"},{status:"picked_up",label:"Package Picked Up"},{status:"enroute_dropoff",label:"En Route to Dropoff"},{status:"arrived_dropoff",label:"Arrived at Dropoff"},{status:"completed",label:"Completed"}];function n(e){let{currentStatus:t}=e,r=i.findIndex(e=>e.status===t);return(0,o.jsx)("div",{style:{padding:"20px 0"},children:(0,o.jsxs)("div",{style:{position:"relative"},children:[(0,o.jsx)("div",{style:{position:"absolute",top:"15px",left:"15px",right:"15px",height:"2px",background:"#e5e5e5",zIndex:0},children:(0,o.jsx)("div",{style:{height:"100%",background:"#6E56CF",width:r>=0?"".concat(r/(i.length-1)*100,"%"):"0%",transition:"width 0.3s ease"}})}),(0,o.jsx)("div",{style:{display:"flex",justifyContent:"space-between",position:"relative",zIndex:1},children:i.map((e,t)=>{let i=t<r,n=t===r;return(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",flex:1},children:[(0,o.jsx)("div",{style:{width:"30px",height:"30px",borderRadius:"50%",background:i||n?"#6E56CF":"#e5e5e5",border:n?"3px solid #6E56CF":"none",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"600",fontSize:"12px",transition:"all 0.3s ease",boxShadow:n?"0 0 0 4px rgba(110, 86, 207, 0.2)":"none"},children:i?"✓":n?"●":""}),(0,o.jsx)("div",{style:{marginTop:"8px",fontSize:"11px",textAlign:"center",color:n?"#6E56CF":i?"#333":"#999",fontWeight:n?"600":"400",maxWidth:"80px",lineHeight:"1.3"},children:e.label})]},e.status)})}),"cancelled"===t&&(0,o.jsx)("div",{style:{marginTop:"16px",padding:"12px",background:"#fee",border:"1px solid #fcc",borderRadius:"6px",color:"#c00",textAlign:"center",fontSize:"14px",fontWeight:"600"},children:"❌ Job Cancelled"})]})})}},1097:(e,t,r)=>{"use strict";r.d(t,{a:()=>n});var o=r(912),i=r(4012);function n(e){let{pickup:t,dropoff:n,courierLocation:a,height:s="400px"}=e,l=(0,i.useRef)(null),d=(0,i.useRef)(null),c=(0,i.useRef)({});return(0,i.useEffect)(()=>{let e="pk.eyJ1IjoiZ29zZW5kZXJyIiwiYSI6ImNtZjFlc2pkMTJheHIya29ub251YjZjMzQifQ.Oav2gJB_Z1sSPjOzjTPCzA";return e?((async()=>{if(!window.mapboxgl){let e=await r.e(670).then(r.t.bind(r,7283,23));window.mapboxgl=e.default}let o=window.mapboxgl;if(o.accessToken=e,!d.current&&l.current){let e=new o.Map({container:l.current,style:"mapbox://styles/mapbox/streets-v12",center:[t.lng,t.lat],zoom:12});d.current=e,e.on("load",()=>{c.current.pickup=new o.Marker({color:"#16a34a"}).setLngLat([t.lng,t.lat]).setPopup(new o.Popup().setHTML("<strong>Pickup</strong>".concat(t.label?"<br/>".concat(t.label):""))).addTo(e),c.current.dropoff=new o.Marker({color:"#dc2626"}).setLngLat([n.lng,n.lat]).setPopup(new o.Popup().setHTML("<strong>Dropoff</strong>".concat(n.label?"<br/>".concat(n.label):""))).addTo(e);let r=new o.LngLatBounds;r.extend([t.lng,t.lat]),r.extend([n.lng,n.lat]),e.fitBounds(r,{padding:50})})}})(),()=>{d.current&&(d.current.remove(),d.current=null)}):void console.warn("Mapbox token not found")},[t.lat,t.lng,n.lat,n.lng,t.label,n.label]),(0,i.useEffect)(()=>{if(!d.current)return;let e=window.mapboxgl;e&&(a&&a.lat&&a.lng?c.current.courier?c.current.courier.setLngLat([a.lng,a.lat]):c.current.courier=new e.Marker({color:"#2563eb"}).setLngLat([a.lng,a.lat]).setPopup(new e.Popup().setHTML("<strong>Courier</strong>")).addTo(d.current):c.current.courier&&(c.current.courier.remove(),c.current.courier=null))},[null==a?void 0:a.lat,null==a?void 0:a.lng]),(0,o.jsx)("div",{ref:l,style:{height:s,borderRadius:"8px"}})}},1444:(e,t,r)=>{"use strict";r.d(t,{J:()=>a});var o=r(4012),i=r(4555),n=r(9685);function a(e){let[t,r]=(0,o.useState)(null),[a,s]=(0,o.useState)(!0);return(0,o.useEffect)(()=>{if(!e){r(null),s(!1);return}let t=(0,i.H9)(n.db,"jobs",e),o=(0,i.aQ)(t,e=>{e.exists()?r(e.data()):r(null),s(!1)});return()=>o()},[e]),{job:t,loading:a}}},1698:(e,t,r)=>{"use strict";function o(e,t,r){return void 0!==e.maxPickupMiles&&r>e.maxPickupMiles?{eligible:!1,reason:"Pickup is outside courier radius"}:void 0!==e.maxJobMiles&&t>e.maxJobMiles?{eligible:!1,reason:"Trip distance exceeds courier max"}:{eligible:!0}}r.d(t,{m:()=>o})},4962:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var o=r(912),i=r(4012),n=r(5951),a=r(5284),s=r(1444),l=r(9740),d=r(5046),c=r(747),u=r(1097),p=r(7473),f=r(355),x=r(7274),g=r.n(x);function h(){var e,t,r,x;let h=(0,n.useParams)(),b=(0,n.useRouter)(),v=null==h?void 0:h.jobId,{uid:m}=(0,a.Z)(),{job:j,loading:k}=(0,s.J)(v),{userDoc:y}=(0,l.T)(),[w,_]=(0,i.useState)(!1),C=async()=>{if(!j||!m)return;if(!(0,f.qF)(j,m))return void alert("You cannot advance this job");let e=(0,f.EN)(j.status);if(e){_(!0);try{await (0,p.r7)(v,e,m),"completed"===e&&setTimeout(()=>b.push("/v2/courier/dashboard"),1e3)}catch(e){console.error("Failed to update status:",e),alert("Failed to update status. Please try again.")}finally{_(!1)}}};if(k)return(0,o.jsx)("div",{style:{padding:"30px"},children:(0,o.jsx)("p",{children:"Loading job..."})});if(!j)return(0,o.jsxs)("div",{style:{padding:"30px"},children:[(0,o.jsx)("p",{children:"Job not found"}),(0,o.jsx)(g(),{href:"/v2/courier/dashboard",style:{color:"#6E56CF"},children:"← Back to Dashboard"})]});if(j.courierUid!==m)return(0,o.jsxs)("div",{style:{padding:"30px"},children:[(0,o.jsx)("p",{children:"This is not your job"}),(0,o.jsx)(g(),{href:"/v2/courier/dashboard",style:{color:"#6E56CF"},children:"← Back to Dashboard"})]});let E=(0,f.EN)(j.status),D="https://www.google.com/maps/dir/?api=1&destination=".concat(j.pickup.lat,",").concat(j.pickup.lng),M="https://www.google.com/maps/dir/?api=1&destination=".concat(j.dropoff.lat,",").concat(j.dropoff.lng);return(0,o.jsxs)("div",{style:{padding:"30px",maxWidth:"1200px",margin:"0 auto"},children:[(0,o.jsx)("div",{style:{marginBottom:"20px"},children:(0,o.jsx)(g(),{href:"/v2/courier/dashboard",style:{color:"#6E56CF",textDecoration:"none"},children:"← Back to Dashboard"})}),(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:"30px"},children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("h1",{style:{margin:0,marginBottom:"8px"},children:"Active Job"}),(0,o.jsxs)("div",{style:{color:"#666",fontSize:"14px"},children:["Accepted: ",(null==(r=j.updatedAt)||null==(t=r.toDate)||null==(e=t.call(r))?void 0:e.toLocaleString())||"Just now"]})]}),(0,o.jsx)(d.t,{status:j.status})]}),(0,o.jsx)("div",{style:{marginBottom:"30px",padding:"20px",background:"white",borderRadius:"8px",border:"1px solid #ddd"},children:(0,o.jsx)(c.m,{currentStatus:j.status})}),(0,o.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"30px",marginBottom:"30px"},children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("h3",{children:"Locations"}),(0,o.jsxs)("div",{style:{display:"grid",gap:"16px"},children:[(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"4px"},children:[(0,o.jsx)("strong",{children:"\uD83D\uDCCD Pickup"}),(0,o.jsx)("a",{href:D,target:"_blank",rel:"noopener noreferrer",style:{fontSize:"12px",color:"#6E56CF",textDecoration:"none",padding:"4px 8px",background:"#f0f0ff",borderRadius:"4px"},children:"Navigate \uD83D\uDDFA️"})]}),(0,o.jsx)("div",{style:{color:"#666",fontSize:"14px"},children:j.pickup.label||"".concat(j.pickup.lat.toFixed(4),", ").concat(j.pickup.lng.toFixed(4))})]}),(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"4px"},children:[(0,o.jsx)("strong",{children:"\uD83D\uDCCD Dropoff"}),(0,o.jsx)("a",{href:M,target:"_blank",rel:"noopener noreferrer",style:{fontSize:"12px",color:"#6E56CF",textDecoration:"none",padding:"4px 8px",background:"#f0f0ff",borderRadius:"4px"},children:"Navigate \uD83D\uDDFA️"})]}),(0,o.jsx)("div",{style:{color:"#666",fontSize:"14px"},children:j.dropoff.label||"".concat(j.dropoff.lat.toFixed(4),", ").concat(j.dropoff.lng.toFixed(4))})]})]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("h3",{children:"Job Info"}),(0,o.jsx)("div",{style:{display:"grid",gap:"12px"},children:(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{children:"Delivery Fee"}),(0,o.jsxs)("div",{style:{fontSize:"24px",fontWeight:"600",color:"#16a34a",marginTop:"4px"},children:["$",(null==(x=j.agreedFee)?void 0:x.toFixed(2))||"0.00"]})]})}),E&&(0,o.jsx)("div",{style:{marginTop:"24px"},children:(0,o.jsx)("button",{onClick:C,disabled:w,style:{width:"100%",padding:"12px",background:w?"#ccc":"#6E56CF",color:"white",border:"none",borderRadius:"8px",fontSize:"16px",fontWeight:"600",cursor:w?"not-allowed":"pointer"},children:w?"Updating...":f.mv[j.status]})}),"completed"===j.status&&(0,o.jsx)("div",{style:{marginTop:"24px",padding:"16px",background:"#f0fdf4",border:"1px solid #86efac",borderRadius:"8px",color:"#166534",textAlign:"center"},children:"✅ Job completed!"})]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("h3",{children:"Live Map"}),(0,o.jsx)(u.a,{pickup:j.pickup,dropoff:j.dropoff,courierLocation:(null==y?void 0:y.location)||null,height:"500px"}),!(null==y?void 0:y.location)&&(0,o.jsx)("p",{style:{color:"#999",fontSize:"14px",marginTop:"8px"},children:"Your location will appear when you're online"})]})]})}},5046:(e,t,r)=>{"use strict";r.d(t,{t:()=>a});var o=r(912);let i={open:"#808080",assigned:"#2563eb",enroute_pickup:"#7c3aed",arrived_pickup:"#a855f7",picked_up:"#ea580c",enroute_dropoff:"#dc2626",arrived_dropoff:"#ef4444",completed:"#16a34a",cancelled:"#52525b"},n={open:"Open",assigned:"Assigned",enroute_pickup:"En Route to Pickup",arrived_pickup:"Arrived at Pickup",picked_up:"Picked Up",enroute_dropoff:"En Route to Dropoff",arrived_dropoff:"Arrived at Dropoff",completed:"Completed",cancelled:"Cancelled"};function a(e){let{status:t}=e;return(0,o.jsx)("span",{style:{display:"inline-block",padding:"4px 12px",borderRadius:"12px",fontSize:"12px",fontWeight:"600",color:"white",background:i[t],textTransform:"uppercase",letterSpacing:"0.5px"},children:n[t]})}},5284:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var o=r(4012),i=r(8213),n=r(7492);function a(){let[e,t]=(0,o.useState)(void 0);return(0,o.useEffect)(()=>{let e=(0,i.hg)(n.j2,e=>{t(e)});return()=>e()},[]),{user:e,loading:void 0===e,uid:null==e?void 0:e.uid}}},5951:(e,t,r)=>{"use strict";var o=r(4631);r.o(o,"useParams")&&r.d(t,{useParams:function(){return o.useParams}}),r.o(o,"useRouter")&&r.d(t,{useRouter:function(){return o.useRouter}})},7473:(e,t,r)=>{"use strict";r.d(t,{G7:()=>d,_S:()=>l,r7:()=>c});var o=r(4555),i=r(9685),n=r(7697),a=r(1698),s=r(355);async function l(e,t){let r=(0,o.rJ)(i.db,"jobs");return(await (0,o.gS)(r,{createdByUid:e,status:"open",pickup:t.pickup,dropoff:t.dropoff,courierUid:null,agreedFee:null,createdAt:(0,o.O5)(),updatedAt:(0,o.O5)()})).id}async function d(e,t,r){let s=(0,o.H9)(i.db,"jobs",e),l=(0,o.H9)(i.db,"users",t);await (0,o.c4)(i.db,async e=>{var i;let d=await e.get(s),c=await e.get(l);if(!d.exists())throw Error("Job not found");if(!c.exists())throw Error("Courier not found");let u=d.data(),p=c.data();if("open"!==u.status||null!==u.courierUid)throw Error("Job already claimed or not available");if(!p.location||!(null==(i=p.courier)?void 0:i.rateCard))throw Error("Courier location or rate card not configured");let f=p.location,x=p.courier.rateCard,g=u.pickup,h=u.dropoff,b=(0,n.Sr)(f,g),v=(0,n.Sr)(g,h),m=(0,a.m)(x,v,b);if(!m.eligible)throw Error("not-eligible: ".concat(m.reason||"Job exceeds distance limits"));e.update(s,{courierUid:t,agreedFee:r,status:"assigned",updatedAt:(0,o.O5)()})})}async function c(e,t,r){let n=(0,o.H9)(i.db,"jobs",e);await (0,o.c4)(i.db,async e=>{let i=await e.get(n);if(!i.exists())throw Error("Job not found");let a=i.data();if(r&&a.courierUid!==r)throw Error("Only the assigned courier can update job status");let l=(0,s.EN)(a.status);if(!l)throw Error("Cannot advance from status: ".concat(a.status));if(t!==l)throw Error("Invalid status transition. Expected: ".concat(l,", Received: ").concat(t));e.update(n,{status:t,updatedAt:(0,o.O5)()})})}},7492:(e,t,r)=>{"use strict";r.d(t,{j2:()=>n});var o=r(8213),i=r(9685);let n=(0,o.xI)(i.y)},7697:(e,t,r)=>{"use strict";function o(e,t){let r=e.lat*Math.PI/180,o=t.lat*Math.PI/180,i=(t.lat-e.lat)*Math.PI/180,n=(t.lng-e.lng)*Math.PI/180,a=Math.sin(i/2)*Math.sin(i/2)+Math.cos(r)*Math.cos(o)*Math.sin(n/2)*Math.sin(n/2);return 2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))*3959}function i(e,t,r,o){let i=e.baseFee+e.perMile*t;if(e.pickupPerMile&&void 0!==r&&(i+=e.pickupPerMile*r),e.perMinute&&o){let r=Math.round(t/({walk:3,scooter:10,car:25})[o]*60);i+=e.perMinute*r}return e.minFee&&i<e.minFee&&(i=e.minFee),Math.round(100*i)/100}r.d(t,{Sr:()=>o,qY:()=>i})},9064:(e,t,r)=>{Promise.resolve().then(r.bind(r,4962))},9685:(e,t,r)=>{"use strict";r.d(t,{db:()=>a,y:()=>n});var o=r(5941),i=r(4555);let n=(0,o.Dk)().length?(0,o.Sx)():(0,o.Wp)({apiKey:"AIzaSyAqfUspCXI4-IESvMHeu-7CV-BWjpWLSZ8",authDomain:"gosenderr-6773f.firebaseapp.com",projectId:"gosenderr-6773f",storageBucket:"gosenderr-6773f.firebasestorage.app",messagingSenderId:"92006199493",appId:"1:92006199493:web:6342270d7a40a312aa00ac"}),a=(0,i.aU)(n)},9740:(e,t,r)=>{"use strict";r.d(t,{T:()=>s});var o=r(4012),i=r(4555),n=r(9685),a=r(5284);function s(){let{uid:e,loading:t}=(0,a.Z)(),[r,s]=(0,o.useState)(void 0),[l,d]=(0,o.useState)(!0);return(0,o.useEffect)(()=>{if(t)return void d(!0);if(!e){s(null),d(!1);return}let r=(0,i.aQ)((0,i.H9)(n.db,"users",e),e=>{e.exists()?s(e.data()):s(null),d(!1)},e=>{console.error("Error fetching user doc:",e),s(null),d(!1)});return()=>r()},[e,t]),{userDoc:r,loading:l,uid:e}}}},e=>{e.O(0,[680,661,825,846,274,808,4,358],()=>e(e.s=9064)),_N_E=e.O()}]);