(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[208],{355:(e,t,r)=>{"use strict";r.d(t,{EN:()=>n,mv:()=>o,qF:()=>l});let i={open:null,assigned:"enroute_pickup",enroute_pickup:"arrived_pickup",arrived_pickup:"picked_up",picked_up:"enroute_dropoff",enroute_dropoff:"arrived_dropoff",arrived_dropoff:"completed",completed:null,cancelled:null},o={open:"",assigned:"Start to Pickup",enroute_pickup:"Arrived at Pickup",arrived_pickup:"Confirm Pickup",picked_up:"Start to Dropoff",enroute_dropoff:"Arrived at Dropoff",arrived_dropoff:"Complete Delivery",completed:"",cancelled:""};function n(e){return i[e]}function l(e,t){return e.courierUid===t&&"completed"!==e.status&&"cancelled"!==e.status&&"open"!==e.status&&null!==i[e.status]}},1097:(e,t,r)=>{"use strict";r.d(t,{a:()=>n});var i=r(912),o=r(4012);function n(e){let{pickup:t,dropoff:n,courierLocation:l,height:a="400px"}=e,s=(0,o.useRef)(null),d=(0,o.useRef)(null),c=(0,o.useRef)({});return(0,o.useEffect)(()=>{let e="pk.eyJ1IjoiZ29zZW5kZXJyIiwiYSI6ImNtZjFlc2pkMTJheHIya29ub251YjZjMzQifQ.Oav2gJB_Z1sSPjOzjTPCzA";return e?((async()=>{if(!window.mapboxgl){let e=await r.e(670).then(r.t.bind(r,7283,23));window.mapboxgl=e.default}let i=window.mapboxgl;if(i.accessToken=e,!d.current&&s.current){let e=new i.Map({container:s.current,style:"mapbox://styles/mapbox/streets-v12",center:[t.lng,t.lat],zoom:12});d.current=e,e.on("load",()=>{c.current.pickup=new i.Marker({color:"#16a34a"}).setLngLat([t.lng,t.lat]).setPopup(new i.Popup().setHTML("<strong>Pickup</strong>".concat(t.label?"<br/>".concat(t.label):""))).addTo(e),c.current.dropoff=new i.Marker({color:"#dc2626"}).setLngLat([n.lng,n.lat]).setPopup(new i.Popup().setHTML("<strong>Dropoff</strong>".concat(n.label?"<br/>".concat(n.label):""))).addTo(e);let r=new i.LngLatBounds;r.extend([t.lng,t.lat]),r.extend([n.lng,n.lat]),e.fitBounds(r,{padding:50})})}})(),()=>{d.current&&(d.current.remove(),d.current=null)}):void console.warn("Mapbox token not found")},[t.lat,t.lng,n.lat,n.lng,t.label,n.label]),(0,o.useEffect)(()=>{if(!d.current)return;let e=window.mapboxgl;e&&(l&&l.lat&&l.lng?c.current.courier?c.current.courier.setLngLat([l.lng,l.lat]):c.current.courier=new e.Marker({color:"#2563eb"}).setLngLat([l.lng,l.lat]).setPopup(new e.Popup().setHTML("<strong>Courier</strong>")).addTo(d.current):c.current.courier&&(c.current.courier.remove(),c.current.courier=null))},[null==l?void 0:l.lat,null==l?void 0:l.lng]),(0,i.jsx)("div",{ref:s,style:{height:a,borderRadius:"8px"}})}},1698:(e,t,r)=>{"use strict";function i(e,t,r){return void 0!==e.maxPickupMiles&&r>e.maxPickupMiles?{eligible:!1,reason:"Pickup is outside courier radius"}:void 0!==e.maxJobMiles&&t>e.maxJobMiles?{eligible:!1,reason:"Trip distance exceeds courier max"}:{eligible:!0}}r.d(t,{m:()=>i})},4793:(e,t,r)=>{Promise.resolve().then(r.bind(r,5625))},5284:(e,t,r)=>{"use strict";r.d(t,{Z:()=>l});var i=r(4012),o=r(8213),n=r(7492);function l(){let[e,t]=(0,i.useState)(void 0);return(0,i.useEffect)(()=>{let e=(0,o.hg)(n.j2,e=>{t(e)});return()=>e()},[]),{user:e,loading:void 0===e,uid:null==e?void 0:e.uid}}},5625:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var i=r(912),o=r(4012),n=r(5951),l=r(9740),a=r(5284),s=r(4555),d=r(9685),c=r(7697),u=r(1698);function p(e){let{job:t,rateCard:r,courierLocation:o,transportMode:n,onAccept:l,loading:a=!1}=e,s=(0,c.Sr)(t.pickup,t.dropoff),d=o?(0,c.Sr)(o,t.pickup):void 0,p=void 0!==d?(0,u.m)(r,s,d):{eligible:!0},x=p.eligible,f=p.reason,g=(0,c.qY)(r,s,d,n);return(0,i.jsxs)("div",{style:{padding:"20px",background:"white",border:x?"1px solid #ddd":"2px solid #dc2626",borderRadius:"8px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[(0,i.jsx)("h3",{style:{marginTop:0,marginBottom:"16px"},children:"Job Preview"}),!x&&(0,i.jsxs)("div",{style:{padding:"12px",background:"#fee2e2",border:"1px solid #fca5a5",borderRadius:"6px",marginBottom:"16px"},children:[(0,i.jsx)("div",{style:{fontSize:"13px",fontWeight:"600",color:"#dc2626",marginBottom:"4px"},children:"⚠️ Not Eligible"}),f&&(0,i.jsx)("div",{style:{fontSize:"12px",color:"#991b1b"},children:f})]}),(0,i.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,i.jsxs)("div",{style:{marginBottom:"8px"},children:[(0,i.jsx)("strong",{children:"\uD83D\uDCCD Pickup:"}),(0,i.jsx)("div",{style:{color:"#666",fontSize:"14px",marginTop:"4px"},children:t.pickup.label||"".concat(t.pickup.lat.toFixed(4),", ").concat(t.pickup.lng.toFixed(4))})]}),(0,i.jsxs)("div",{style:{marginBottom:"8px"},children:[(0,i.jsx)("strong",{children:"\uD83D\uDCCD Dropoff:"}),(0,i.jsx)("div",{style:{color:"#666",fontSize:"14px",marginTop:"4px"},children:t.dropoff.label||"".concat(t.dropoff.lat.toFixed(4),", ").concat(t.dropoff.lng.toFixed(4))})]})]}),(0,i.jsxs)("div",{style:{padding:"12px",background:"#f5f5f5",borderRadius:"4px",marginBottom:"16px"},children:[void 0!==d&&(0,i.jsxs)("div",{style:{marginBottom:"8px",fontSize:"14px"},children:[(0,i.jsx)("strong",{children:"Distance to Pickup:"})," ",d.toFixed(2)," mi"]}),(0,i.jsxs)("div",{style:{marginBottom:"8px",fontSize:"14px"},children:[(0,i.jsx)("strong",{children:"Job Distance:"})," ",s.toFixed(2)," mi"]}),(0,i.jsxs)("div",{style:{fontSize:"12px",color:"#666",marginTop:"4px"},children:["$",r.baseFee.toFixed(2)," base + $",r.perMile.toFixed(2),"/mi",r.pickupPerMile&&(0,i.jsxs)("span",{children:[" + $",r.pickupPerMile.toFixed(2),"/mi pickup"]}),r.perMinute&&(0,i.jsxs)("span",{children:[" + $",r.perMinute.toFixed(2),"/min"]})]}),r.minFee&&(0,i.jsxs)("div",{style:{fontSize:"11px",color:"#999",marginTop:"4px"},children:["Minimum: $",r.minFee.toFixed(2)]}),(0,i.jsxs)("div",{style:{marginTop:"12px",fontSize:"20px",fontWeight:"600",color:"#16a34a"},children:["$",g.toFixed(2)]})]}),(0,i.jsx)("button",{onClick:()=>l(t.id,g),disabled:a||!x,title:x?"":"You are not eligible for this job",style:{width:"100%",padding:"12px",background:a||!x?"#ccc":"#16a34a",color:"white",border:"none",borderRadius:"8px",fontSize:"16px",fontWeight:"600",cursor:a||!x?"not-allowed":"pointer"},children:a?"Accepting...":x?"Accept Job":"Cannot Accept"})]})}var x=r(1097),f=r(7473);function g(){var e;let t=(0,n.useRouter)(),{uid:r}=(0,a.Z)(),{userDoc:g,loading:h}=(0,l.T)(),{jobs:b,loading:m}=function(){let[e,t]=(0,o.useState)([]),[r,i]=(0,o.useState)(!0);return(0,o.useEffect)(()=>{let e=(0,s.rJ)(d.db,"jobs"),r=(0,s.P)(e,(0,s._M)("status","==","open")),o=(0,s.aQ)(r,e=>{t(e.docs.map(e=>({id:e.id,...e.data()}))),i(!1)});return()=>o()},[]),{jobs:e,loading:r}}(),[v,j]=(0,o.useState)(null),[y,k]=(0,o.useState)(!1),[w,S]=(0,o.useState)(!0),M=(0,o.useMemo)(()=>{var e;if(!(null==g?void 0:g.location)||!(null==g||null==(e=g.courier)?void 0:e.rateCard))return b.map(e=>{let t=(0,c.Sr)(e.pickup,e.dropoff);return{job:e,eligible:!0,reason:void 0,pickupMiles:void 0,jobMiles:t}});let t=g.location,r=g.courier.rateCard;return b.map(e=>{let i=(0,c.Sr)(t,e.pickup),o=(0,c.Sr)(e.pickup,e.dropoff),n=(0,u.m)(r,o,i);return{job:e,eligible:n.eligible,reason:n.reason,pickupMiles:i,jobMiles:o}})},[b,g]),C=(0,o.useMemo)(()=>w?M.filter(e=>e.eligible):M,[M,w]);(0,o.useEffect)(()=>{var e;h||!g||(null==(e=g.courier)?void 0:e.rateCard)||t.push("/v2/courier/setup")},[h,g,t]),(0,o.useEffect)(()=>{C.length>0&&!v?j(C[0].job):0===C.length&&j(null)},[C,v]);let F=async(e,i)=>{if(r){k(!0);try{await (0,f.G7)(e,r,i),t.push("/v2/courier/jobs/".concat(e))}catch(e){var o;console.error("Failed to claim job:",e),(null==(o=e.message)?void 0:o.includes("not-eligible"))?alert("You are not eligible for this job. It may exceed your distance limits."):alert(e.message||"Failed to claim job. It may have been claimed by another courier."),k(!1),j(null)}}};if(h||m)return(0,i.jsxs)("div",{style:{padding:"30px"},children:[(0,i.jsx)("h1",{children:"Dashboard"}),(0,i.jsx)("p",{children:"Loading..."})]});if(!(null==g||null==(e=g.courier)?void 0:e.rateCard))return(0,i.jsxs)("div",{style:{padding:"30px"},children:[(0,i.jsx)("h1",{children:"Dashboard"}),(0,i.jsx)("p",{children:"Setting up..."})]});let P=g.courier.rateCard;return(0,i.jsxs)("div",{style:{padding:"30px"},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"30px"},children:[(0,i.jsx)("h1",{style:{margin:0},children:"Available Jobs"}),(0,i.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",fontSize:"14px"},children:[(0,i.jsx)("input",{type:"checkbox",checked:w,onChange:e=>S(e.target.checked),style:{cursor:"pointer"}}),(0,i.jsx)("span",{children:"Hide ineligible jobs"})]})]}),0===C.length?(0,i.jsx)("div",{style:{textAlign:"center",padding:"40px",color:"#666"},children:0===M.length?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("p",{children:"No open jobs available right now."}),(0,i.jsx)("p",{style:{fontSize:"14px",marginTop:"8px"},children:"Check back soon or make sure you're online in your setup."})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("p",{children:"All available jobs are outside your service area."}),(0,i.jsx)("p",{style:{fontSize:"14px",marginTop:"8px"},children:(0,i.jsx)("button",{onClick:()=>S(!1),style:{padding:"8px 16px",background:"#6E56CF",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px"},children:"Show all jobs"})})]})}):(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:"30px"},children:[(0,i.jsxs)("div",{children:[v&&(0,i.jsx)("div",{style:{marginBottom:"24px"},children:(0,i.jsx)(x.a,{pickup:v.pickup,dropoff:v.dropoff,courierLocation:(null==g?void 0:g.location)||null,height:"400px"})}),(0,i.jsx)("div",{style:{display:"grid",gap:"16px"},children:C.map(e=>{var t,r,o;let{job:n,eligible:l,reason:a,pickupMiles:s,jobMiles:d}=e;return(0,i.jsxs)("div",{onClick:()=>j(n),style:{padding:"20px",background:(null==v?void 0:v.id)===n.id?"#f0f0ff":"white",border:(null==v?void 0:v.id)===n.id?"2px solid #6E56CF":l?"1px solid #ddd":"2px solid #dc2626",borderRadius:"8px",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:e=>{(null==v?void 0:v.id)!==n.id&&(e.currentTarget.style.background="#f9f9f9")},onMouseLeave:e=>{(null==v?void 0:v.id)!==n.id&&(e.currentTarget.style.background="white")},children:[!l&&(0,i.jsxs)("div",{style:{marginBottom:"12px",padding:"6px 10px",background:"#fee2e2",border:"1px solid #fecaca",borderRadius:"4px",display:"inline-block"},children:[(0,i.jsx)("div",{style:{fontSize:"11px",fontWeight:"600",color:"#dc2626",marginBottom:"2px"},children:"⚠️ Not eligible"}),a&&(0,i.jsx)("div",{style:{fontSize:"10px",color:"#991b1b"},children:a})]}),(0,i.jsxs)("div",{style:{fontSize:"14px",color:"#666",marginBottom:"12px"},children:["Posted: ",(null==(o=n.createdAt)||null==(r=o.toDate)||null==(t=r.call(o))?void 0:t.toLocaleString())||"Just now"]}),(0,i.jsxs)("div",{style:{display:"grid",gap:"8px"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"\uD83D\uDCCD Pickup:"})," ",(0,i.jsx)("span",{style:{color:"#666"},children:n.pickup.label||"".concat(n.pickup.lat.toFixed(4),", ").concat(n.pickup.lng.toFixed(4))}),s&&(0,i.jsxs)("span",{style:{fontSize:"12px",color:"#999",marginLeft:"8px"},children:["(",s.toFixed(1)," mi away)"]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"\uD83D\uDCCD Dropoff:"})," ",(0,i.jsx)("span",{style:{color:"#666"},children:n.dropoff.label||"".concat(n.dropoff.lat.toFixed(4),", ").concat(n.dropoff.lng.toFixed(4))}),d&&(0,i.jsxs)("span",{style:{fontSize:"12px",color:"#999",marginLeft:"8px"},children:["(",d.toFixed(1)," mi trip)"]})]})]})]},n.id)})})]}),v&&(0,i.jsx)("div",{style:{position:"sticky",top:"20px",height:"fit-content"},children:(0,i.jsx)(p,{job:v,rateCard:P,courierLocation:(null==g?void 0:g.location)||null,transportMode:g.courier.transportMode,onAccept:F,loading:y})})]})]})}},5951:(e,t,r)=>{"use strict";var i=r(4631);r.o(i,"useParams")&&r.d(t,{useParams:function(){return i.useParams}}),r.o(i,"useRouter")&&r.d(t,{useRouter:function(){return i.useRouter}})},7473:(e,t,r)=>{"use strict";r.d(t,{G7:()=>d,_S:()=>s,r7:()=>c});var i=r(4555),o=r(9685),n=r(7697),l=r(1698),a=r(355);async function s(e,t){let r=(0,i.rJ)(o.db,"jobs");return(await (0,i.gS)(r,{createdByUid:e,status:"open",pickup:t.pickup,dropoff:t.dropoff,courierUid:null,agreedFee:null,createdAt:(0,i.O5)(),updatedAt:(0,i.O5)()})).id}async function d(e,t,r){let a=(0,i.H9)(o.db,"jobs",e),s=(0,i.H9)(o.db,"users",t);await (0,i.c4)(o.db,async e=>{var o;let d=await e.get(a),c=await e.get(s);if(!d.exists())throw Error("Job not found");if(!c.exists())throw Error("Courier not found");let u=d.data(),p=c.data();if("open"!==u.status||null!==u.courierUid)throw Error("Job already claimed or not available");if(!p.location||!(null==(o=p.courier)?void 0:o.rateCard))throw Error("Courier location or rate card not configured");let x=p.location,f=p.courier.rateCard,g=u.pickup,h=u.dropoff,b=(0,n.Sr)(x,g),m=(0,n.Sr)(g,h),v=(0,l.m)(f,m,b);if(!v.eligible)throw Error("not-eligible: ".concat(v.reason||"Job exceeds distance limits"));e.update(a,{courierUid:t,agreedFee:r,status:"assigned",updatedAt:(0,i.O5)()})})}async function c(e,t,r){let n=(0,i.H9)(o.db,"jobs",e);await (0,i.c4)(o.db,async e=>{let o=await e.get(n);if(!o.exists())throw Error("Job not found");let l=o.data();if(r&&l.courierUid!==r)throw Error("Only the assigned courier can update job status");let s=(0,a.EN)(l.status);if(!s)throw Error("Cannot advance from status: ".concat(l.status));if(t!==s)throw Error("Invalid status transition. Expected: ".concat(s,", Received: ").concat(t));e.update(n,{status:t,updatedAt:(0,i.O5)()})})}},7492:(e,t,r)=>{"use strict";r.d(t,{j2:()=>n});var i=r(8213),o=r(9685);let n=(0,i.xI)(o.y)},7697:(e,t,r)=>{"use strict";function i(e,t){let r=e.lat*Math.PI/180,i=t.lat*Math.PI/180,o=(t.lat-e.lat)*Math.PI/180,n=(t.lng-e.lng)*Math.PI/180,l=Math.sin(o/2)*Math.sin(o/2)+Math.cos(r)*Math.cos(i)*Math.sin(n/2)*Math.sin(n/2);return 2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*3959}function o(e,t,r,i){let o=e.baseFee+e.perMile*t;if(e.pickupPerMile&&void 0!==r&&(o+=e.pickupPerMile*r),e.perMinute&&i){let r=Math.round(t/({walk:3,scooter:10,car:25})[i]*60);o+=e.perMinute*r}return e.minFee&&o<e.minFee&&(o=e.minFee),Math.round(100*o)/100}r.d(t,{Sr:()=>i,qY:()=>o})},9685:(e,t,r)=>{"use strict";r.d(t,{db:()=>l,y:()=>n});var i=r(5941),o=r(4555);let n=(0,i.Dk)().length?(0,i.Sx)():(0,i.Wp)({apiKey:"AIzaSyAqfUspCXI4-IESvMHeu-7CV-BWjpWLSZ8",authDomain:"gosenderr-6773f.firebaseapp.com",projectId:"gosenderr-6773f",storageBucket:"gosenderr-6773f.firebasestorage.app",messagingSenderId:"92006199493",appId:"1:92006199493:web:6342270d7a40a312aa00ac"}),l=(0,o.aU)(n)},9740:(e,t,r)=>{"use strict";r.d(t,{T:()=>a});var i=r(4012),o=r(4555),n=r(9685),l=r(5284);function a(){let{uid:e,loading:t}=(0,l.Z)(),[r,a]=(0,i.useState)(void 0),[s,d]=(0,i.useState)(!0);return(0,i.useEffect)(()=>{if(t)return void d(!0);if(!e){a(null),d(!1);return}let r=(0,o.aQ)((0,o.H9)(n.db,"users",e),e=>{e.exists()?a(e.data()):a(null),d(!1)},e=>{console.error("Error fetching user doc:",e),a(null),d(!1)});return()=>r()},[e,t]),{userDoc:r,loading:s,uid:e}}}},e=>{e.O(0,[680,661,825,846,808,4,358],()=>e(e.s=4793)),_N_E=e.O()}]);